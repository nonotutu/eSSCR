
- if controller_name == 'events'
  - event_id = params[:id].to_i
- else
  - event_id = params[:event_id].to_i

- if controller_name == 'services'
  - service_id = params[:id].to_i
- else
  - service_id = params[:service_id].to_i

- if (params[:tri_ordre].present?)
  - session[:tri_ordre] = params[:tri_ordre]

- if (params[:tri_annee].present?)
  - session[:tri_annee] = params[:tri_annee]

  
- liste_ordre = []
- liste_ordre << { :value => '1', :name => 'croissant' }
- liste_ordre << { :value => '2', :name => 'décroissant' }
- liste_ordre << { :value => '3', :name => 'alphabétique' }
- liste_ordre << { :value => '4', :name => 'désalphabétique' }


- liste_annee = []
- liste_annee << { :value => 'all', :name => 'toutes' }
- liste_annee << { :value => '2010', :name => '2010' }
- liste_annee << { :value => '2011', :name => '2011' }
- liste_annee << { :value => '2012', :name => '2012' }


%form{:action => '', :method => :get}
  Order by : 
  %select{:name => 'tri_ordre'}
    = liste_ordre.each do |item|
      -  selected = ( item[:value] == session[:tri_ordre] ? 'selected' : nil )
      %option{ :value => item[:value], :selected => selected }= item[:name]
  %br/
  Year : 
  %select{:name => 'tri_annee'}
    = liste_annee.each do |item|
      - selected = ( item[:value] == session[:tri_annee] ? 'selected' : nil )
      %option{ :value => item[:value], :selected => selected }= item[:name]
  %input{:type => :submit}



:ruby
  services = Service.where("starts_at > '2012-06-09'").order(:starts_at).all

  #  case(session[:tri_ordre])
  #    when '1'
  #   else
  # end

  #  if ( session[:tri_annee].present? )
  #    unless ( session[:tri_annee] == 'all' )
  #      events = Event.joins(:services).where("SUBSTR(starts_at,1,4) = ?", session[:tri_annee])
  #    end
  #  end

.menu_gauche
  .menu_gauche_3
    = render "events/test", :services => services, :service_id => service_id

-#
  .menu_gauche_3
    %ul
      %li= link_to '→ New event', new_event_path
      - services.group_by(&:event).each do |event, servicess|
        %li
          = event.category.short_name + " - " + event.name
          %ul
          - servicess.each do |service|
            %li= service.to_s

-#
  - active = (service_id == service.id ? :active : nil)
  = 
  %br
  = link_to ("----" + service.to_s), event_service_path(service.event.id, service.id), :class => active
          
  %ul
    %li= link_to '→ New event', new_event_path
    - services.each do |service|
      - if service.event.id == last_event_id
        = service.to_s
        %li
      - else
        %li
          = service.event.category.short_name + " - " + service.event.name
          %ul
            %li
      - last_event_id = service.event.id
